# 1. 解决方案介绍



## 团队介绍

- 成员组成：

  - otto data lab（刘世欢、陈欣）、周阳（重庆邮电大学 研二）、陈艺 （华为）、李孟禹（天池科学家）

    历史荣誉：

    - Kaggle-IEEE-CIS Fraud Detection-金牌
    - KDD Cup 2020 Debiasing-Top6

    - 2020数字中国创新大赛—算法赛：智慧海洋建设-亚军•

    - "合肥高新杯"心电人机智能大赛-亚军


    - 首届"马栏山杯"国际音视频算法大赛视频推荐赛道-季军


    - 第二届阿里巴巴大数据智能云上编程大赛-智联招聘人岗智能匹配-Top4
    - 2020年中国高校计算机大赛-华为云大数据挑战赛-冠军
    - 2019年中国高校计算机大赛-大数据挑战赛-Top6
    - 2019年CCF BDCI 金融信息负面及主体判定赛题-冠军
    - 2019年DigSci科学数据挖掘大赛-冠军
    - 2019年CCF BDCI乘用车细分市场销量预测赛题-季军
    - 2020年科大讯飞事件抽取挑战赛-Top5
    - 2020年科大讯飞农业问答数据处理挑战赛-Top5

---

## 解决方案

- **赛题理解**：本次赛题提供了一个月的基于当前link的历史同期时序特征和当前历史时序特征预测未来1-30时间片的拥堵情况。

- **数据分析**：

  - 测试集分布问题：本次比赛测试集分布与训练集分布非常不一致，主要表现：

    - 测试集预测时间集中在凌晨，历史同期序列和当前历史序列缺失值多。
    - 预测gap（需要预测的时间片-当前时间片）集中在20+，预测时间片与当前时间片差距大，测试集难度更大。

    因此，经过我们的分析，若使用传统特征工程建模，需要对目前的训练集进行采样。

  - 拓扑序列无法利用时序特征：训练集和测试集一共只包含了1万多的link的时序特征，然而整个拓扑图有60多万，因此在拓扑中利用时序特征无法实现，所以只能尽可能的捕捉拓扑**静态特征**。

- **方案**

  ### 采样+特征工程+Lightgbm

  - 采样：首先由于测试集分布集中在凌晨这一时段，所以我们从训练集获取20190706-20190730这25天中future_slice_id大于10，小于40的样本，并从30号的future_slice_id超过40的样本中采样5万条记录作为原始训练集A，再根据测试集的curr_state的分布比例对A进行采样获得B，接着根据测试集中的future_slice_id和current_slice_id的时间差的分布比例对B进行采样获得C，并按照测试集的分布进行去重，最后获取到了和测试集分布较为接近的训练集D，后续的特征工程主要在D的基础上进行。

  - 特征工程：

  ```
    (1) 目标编码，历史同link/future_slice_id/link+小时/link+星期/link+小时+星期的三种道路状况比例
  (2) 该link+future_slice_id近期的速度、车辆数，路况等统计
    (3) 该link+future_slice_id近N个时间片内各状态距离当前时间的时间间隔
  (4) 提取link拓扑信息中的上游和下游，统计其对应future_slice_id前的道路状况
  ```

  - 训练：Lightgbm5折交叉训练。

  - 分数：A榜0.513

  

  ---

  

  ### 基于子图的GCN+LSTM+NFM模型

  **思路**：路况时空预测自然拓扑特征很重要，然而一般来说拓扑图节点很多，不易建模和训练，因此我们选择构建子图，然后通过GCN来步骤当前节点的拓扑空间特征，其次，对于历史同期特征和当前历史特征，通过LSTM来捕捉当前节点的时序特征，此外，我们还对link的类别特征以及当前时间的类别特征通过NFM进行特征提取，所以整个NN分为3个部分，下面分别介绍：

  **(1).基于子图的GCN**：

  - 子图构建：对于每一个节点，扩展到4阶，构建上下4阶的无向图，最大节点数：200个。

  - 节点特征：link id+原始8维特征 做embedding，特别的，连续特征用一个embedding向量与连续值相乘。

  - 网络结构：采用经典的GCN结构，计算公式为：

  <img src="https://pic1.zhimg.com/80/v2-94c7d5014d9e9bcf81f630831cf9d9f0_720w.png" alt="img" style="zoom:50%;" />

  

  ---

  **(2).LSTM**：

    - 历史同期序列：双层单向LSTM，时间步为5，每个时间特征为4个原始特征，历史4个同期分别输入。
  - 当前历史序列：双层单向LSTM，时间步为5，每个时间特征为4个原始特征。

  ---

  

  **(3).NFM**

  - 类别特征：原始数据所有类别特征（当前link的道路属性）、当前时间片、待预测时间片、时间片gap，小时，星期等，对于连续属性特征，同样采用一个embedding向量与连续值相乘的形式。
    - 结构：经典NFM结构，只保留了**Bi-Interation Poling**部分。

    ---

  训练数据：7-1 ---7-29 所有数据

  验证数据：7-30

  损失函数：加权交叉熵 权重为 0.1：0.3：0.6  ，**拥堵越严重权重越大（与线上评价指标类似）**。

  **成绩：A榜单模0.520**

  ### 模型融合

  线性加权：final=nnx0.7+lgbx0.3 
